<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="title" content="ethanytang" />
  <meta name="robots" content="index, follow" />
  <link rel="icon" href="clever.png" type="image/png" />
  <title>Clever | Portal</title>
  <script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js"></script>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <canvas id="fluid"></canvas>
  <div id="announcement-popup" class="popup-overlay">

  <nav class="navbar">
    <a href="index.html">Home</a>
    <a href="/about.html">About Me</a>
    <a href="/log.html">Log</a>
    <a href="/birthday.html">Bday cntdwn</a>
    <div class="dark-mode-toggle">
      <span>Dark Mode</span>
      <label class="switch">
        <input type="checkbox" id="theme-toggle">
        <span class="slider"></span>
      </label>
    </div>
  </nav>

  <main>
    <br />
    <p>I'm Ethan, I go to MMS, I'm 14 years old, and this is my website.</p>
    <h3>thank you to bruno for inspiration to make this</h3>
    <p>guys ask me for the new link for cosmos cuz i have it</p>
    <p>by entering this site, you agree to the</p>
    <a href="/terms.html" class="gfiles-button">terms of service</a>
    <a href="https://hits.sh/ethanytangcodes.github.io/"><img alt="Hits" src="https://hits.sh/ethanytangcodes.github.io.svg"/></a>
    <h1 id="projects">Made by Ethan Tang</h1>
    <a href="/cosmos" class="gfiles-button">cosmos link</a>
    <button class="gfiles-button" id="do-not-click-btn">DO NOT CLICK BY ANY MEANS</button>
    <div class="spacer"></div>
  </main>

  <div id="survey-popup" class="survey-popup">
    <span>pls fill this in for suggestions and bugs</span>
    <a href="https://docs.google.com/forms/d/e/1FAIpQLScDuLLtm7qWruDL31I9IO2doAh6S89Rb-n9vi_Ufp0CowYwfQ/viewform?usp=dialog" target="_blank">survey?</a>
    <button id="survey-close" class="survey-close">&times;</button>
  </div>

  <script>
  setTimeout(() => {
    const survey = document.getElementById("survey-popup");
    survey.classList.add("show"); 
  }, 4000);

  document.getElementById("survey-close").onclick = () => {
    const survey = document.getElementById("survey-popup");
    survey.classList.remove("show"); 
  };
    

  (async () => {
      const welcomeMsg = document.createElement("div");
      welcomeMsg.style.padding = "10px 20px";
      welcomeMsg.style.borderRadius = "12px";
      welcomeMsg.style.fontSize = "18px";
      welcomeMsg.style.fontWeight = "bold";
      welcomeMsg.style.boxShadow = "0 4px 12px rgba(0, 0, 0, 0.3)";
      welcomeMsg.style.margin = "20px auto";
      welcomeMsg.style.width = "300px";
      welcomeMsg.style.textAlign = "center";
      welcomeMsg.style.display = "block";

      const navbar = document.querySelector(".navbar");
      navbar.insertAdjacentElement("afterend", welcomeMsg);

      const fp = await FingerprintJS.load();
      const result = await fp.get();
      const visitorId = result.visitorId;

      const specialIDs = ["a8538f04739a15f3686e4ef1068c57bd"];
      const visits = parseInt(localStorage.getItem("visits") || "0") + 1;
      localStorage.setItem("visits", visits);

      if (specialIDs.includes(visitorId)) {
          welcomeMsg.textContent = "ðŸ”¥ Welcome back, VIP! ðŸ”¥";
          welcomeMsg.style.backgroundColor = "#ff4500";
          welcomeMsg.style.color = "#fff";
      } else {
          welcomeMsg.textContent = visits === 1
              ? "Welcome to the site for the first time!"
              : `Welcome back! You've visited this site ${visits} times.`;
          welcomeMsg.style.backgroundColor = "#333";
          welcomeMsg.style.color = "#fff";
      }

      fetch("https://ipinfo.io/json?token=d3c139f7603b13")
          .then(res => res.json())
          .then(data => {
              let extraAlert = "";
              if (data.ip === "205.174.240.234") {
                  welcomeMsg.textContent = visits === 1
                      ? "ðŸŽ“ Miller student detected! This is your first visit."
                      : `ðŸŽ“ Miller student detected! You've visited this site ${visits} times.`;
                  extraAlert = "MILLER STUDENT DETECTED";
              }

              const message = `
ðŸ“¡ New visitor on your site!
ðŸ†” FingerprintJS ID: ${visitorId}
ðŸ§  IP: ${data.ip}
ðŸŒ Location: ${data.city}, ${data.region}, ${data.country}
ðŸ“ Coords: ${data.loc}
ðŸ•¹ ISP: ${data.org}
ðŸ’» User Agent: ${navigator.userAgent}
ðŸ“… Time: ${new Date().toLocaleString()}
Visits: ${visits}
${extraAlert}
              `;

              fetch("https://logger.ethantytang11.workers.dev/", {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({ message: message })
              })
              .then(res => res.text())
              .then(console.log)
              .catch(console.error);
          })
          .catch(err => console.error("âš ï¸ IP fetch error:", err));
  })();


  // === COOKIES HELPERS ===
  function setCookie(name, value, days) {
    const d = new Date();
    d.setTime(d.getTime() + (days*24*60*60*1000));
    document.cookie = name + "=" + value + ";expires=" + d.toUTCString() + ";path=/";
  }

  function getCookie(name) {
    const decodedCookie = decodeURIComponent(document.cookie);
    const ca = decodedCookie.split(';');
    const prefix = name + "=";
    for (let c of ca) {
      c = c.trim();
      if (c.indexOf(prefix) === 0) return c.substring(prefix.length, c.length);
    }
    return "";
  }

  const toggle = document.getElementById('theme-toggle');
  const savedTheme = getCookie("theme");

  if (savedTheme === "dark") {
    document.body.classList.add("dark");
    toggle.checked = true;
  }

  toggle.addEventListener('change', () => {
    if (toggle.checked) {
      document.body.classList.add("dark");
      setCookie("theme", "dark", 365);
    } else {
      document.body.classList.remove("dark");
      setCookie("theme", "light", 365);
    }
  });
  </script>

  <script type="module">
    import useFluidCursor from './fluid.js';
    useFluidCursor();
  </script>


  <!-- âœ… SECRET POPUP HTML -->
  <div id="secret-popup" class="secret-popup">
    <div class="secret-content">
      <h2>links</h2>
      <p>idrc if u share the secret keybind</p>
      <ul>
        <li><a href="/cosmos">new game site</a></li>
      </ul>
      <button id="secret-close">Close</button>
    </div>
  </div>

  <!-- DO NOT CLICK POPUP -->
  <div id="do-not-click-popup" class="do-not-click-popup">
    <div class="do-not-click-content">
      <h2>wow.</h2>
      <p id="click-message">Loading...</p>
      <p>make sure not to tell your friends</p>
      <button id="do-not-click-close">Close</button>
    </div>
  </div>

  <!-- âœ… SECRET POPUP SCRIPT -->
  <script>
    let lastKey = "";

    document.addEventListener("keydown", (e) => {
      const key = e.key.toLowerCase();

      if (lastKey === "e" && key === "t") {
        document.getElementById("secret-popup").classList.add("show");
      }

      lastKey = key;

      setTimeout(() => {
        lastKey = "";
      }, 670);
    });

    document.getElementById("secret-close").onclick = () => {
      document.getElementById("secret-popup").classList.remove("show");
    };
  </script>

  <!-- DO NOT CLICK SCRIPT -->
  <script>
    const doNotClickBtn = document.getElementById("do-not-click-btn");
    const doNotClickPopup = document.getElementById("do-not-click-popup");
    const doNotClickClose = document.getElementById("do-not-click-close");
    const clickMessage = document.getElementById("click-message");

    // Check if user has already clicked and get their count
    const hasClicked = localStorage.getItem("hasClickedPrank");
    const userCount = localStorage.getItem("userPrankCount");

    doNotClickBtn.addEventListener("click", async () => {
      try {
        // If they've already clicked, show their original count + current total
        if (hasClicked === "true" && userCount) {
          // Get current count without incrementing
          const response = await fetch("https://prank.ethantytang11.workers.dev/get", {
            method: "GET"
          });
          
          const data = await response.json();
          const currentTotal = data.count || data.value || 0;
          
          clickMessage.innerHTML = `you already fell for it<br>you were the ${userCount} person to click it<br>${currentTotal} people have clicked it so far`;
          doNotClickPopup.classList.add("show");
          return;
        }

        // First time clicking - increment counter
        const response = await fetch("https://prank.ethantytang11.workers.dev/increment", {
          method: "GET"
        });
        
        const data = await response.json();
        console.log("Response from worker:", data);
        
        // The response should contain the new count value
        const count = data.count || data.value || 1;
        
        // Determine ordinal suffix (1st, 2nd, 3rd, 4th, etc.)
        let suffix = "th";
        const lastTwo = count % 100;
        if (lastTwo < 11 || lastTwo > 13) {
          switch (count % 10) {
            case 1: suffix = "st"; break;
            case 2: suffix = "nd"; break;
            case 3: suffix = "rd"; break;
          }
        }
        
        const countStr = `${count}${suffix}`;
        clickMessage.textContent = `you are the ${countStr} person to fall for it`;
        
        // Mark that they've clicked and save their count
        localStorage.setItem("hasClickedPrank", "true");
        localStorage.setItem("userPrankCount", countStr);
        
      } catch (error) {
        console.error("Counter error:", error);
        clickMessage.textContent = "you fell for it (couldn't load exact count)";
        localStorage.setItem("hasClickedPrank", "true");
      }
      
      doNotClickPopup.classList.add("show");
    });

    doNotClickClose.onclick = () => {
      doNotClickPopup.classList.remove("show");
    };

    // Close when clicking outside
    doNotClickPopup.addEventListener("click", (e) => {
      if (e.target === doNotClickPopup) {
        doNotClickPopup.classList.remove("show");
      }
    });
  </script>

</body>
</html>
